{% extends 'base.html' %}

{% block center %}


<style>
.input-append{
text-align:center;
margin-left:auto; 
margin-right:auto;
}
</style>
<script language="JavaScript" type="text/javascript" src="http://www.my97.net/dp/My97DatePicker/WdatePicker.js"></script>
<script>
String.prototype.Trim = function() 
{ 
    return this.replace(/(^\s*)|(\s*$)/g, ""); 
}
function repay(myid){
    var r = confirm("确认还款?");
    if(r==true){
    $.ajax({
        type: "POST",
        data: "repayitem_id="+myid,
        url: "/statusrepayitem/1/",
        dataType: "json",
        cache: false,
        success: function(data){ 
            with (data.message)
            {
                if(Trim()=='true'){
                    var me = document.getElementById("operate_"+myid);
                    me.innerHTML= "";
                    alert(data.info);
                }
                else{
                    alert(data.info);
                }
            }
         }
        }); 
    }
}  
function renewal(myid){
    var r = confirm("确认续签?");
    if(r==true){
    $.ajax({
        type: "POST",
        data: "repayitem_id="+myid,
        url: "/statusrepayitem/2/",
        dataType: "json",
        cache: false,
        success: function(data){ 
            with (data.message)
            {
                if(Trim()=='true'){
                    var me = document.getElementById("operate_"+myid);
                    me.innerHTML= "";
                    alert(data.info);
                }
                else{
                    alert(data.info);
                }
            }
         }
        }); 
    }
} 

</script>

<h2>还款查询</h2>
<div class="input-append" >
    <form action="/queryrepayitems/{{type_id}}" method="get">
    起始日期
    <input id="fromdate" name="fromdate" onClick="WdatePicker()">
    终止日期
    <input id="todate" name="todate" onClick="WdatePicker()">
    <input type="text" name="contract_id" placeholder="合同编号">
    <input type="submit" value="Search">
    </form>
</div>
    <div class="container">
   
      <table class="table">
        <thead>
          <tr>
            <th>还款日期</th>
            <th>还款金额</th>
            <th>操作</th>
            <th>所属合同编号</th>
          </tr>
        </thead>
        <tbody>
        {%for item in repayitems%}
        <tr id="row_{{item.id}}">
            <td>{{item.repaydate}}</td>
            <td>{{item.repaymoney}}</td>
            <td>
                <div id="operate_{{item.id}}">
                {%ifequal item.status 1%}
                <button onclick="repay({{item.id}})">还款</button>
                {%ifequal item.repaytype 2%}
                <button onclick="renewal({{item.id}})">续签</button>
                {%endifequal%}
                {%ifequal item.repaytype 3%}
                <button onclick="renewal({{item.id}})">续签</button>
                {%endifequal%}
                {%endifequal%}
                </div>
            </td>
            <td><a href="/contract/{{item.thiscontract.id}}">{{item.thiscontract.number}}</a></td>            
        </tr>
        {%endfor%}
        </tbody>
      </table>
    </div>
        
{% endblock %}
